import Head from 'next/head';
import Hero from '@/components/home/Hero';
import { jewelry } from '@/shared/variables/hero';
import { GetStaticProps } from 'next';
import { Product as ProductType } from '@/shared/types/products';
import productsByType from '@/shared/functions/productsByType';
import Products from '@/components/home/Products';
import getProducts from '@/shared/functions/getProducts';

type Props = {
  filteredProducts: Record<string, ProductType[]>;
};

export default function Home({ filteredProducts }: Props) {
  const { title, subtitle, image } = jewelry;
  const productsEntries = Object.entries(filteredProducts);

  return (
    <>
      <Head>
        <title>{title}</title>
        <meta name='description' content='Generated by create next app' />
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <link rel='icon' href='/favicon.ico' />
      </Head>
      <Hero title={title} subtitle={subtitle} image={image} />
      <section className='responsive_width' style={{ paddingBlock: '40px' }}>
        {productsEntries.map(([key, products]) => (
          <Products key={key} products={products} />
        ))}
      </section>
    </>
  );
}

export const getStaticProps: GetStaticProps = async (context) => {
  const products = await getProducts();
  const uniqueTypes = [...new Set(products.map((product) => product.product_type))];

  const filteredProducts = productsByType(products, uniqueTypes);

  return {
    props: {
      filteredProducts,
    },
  };
};
